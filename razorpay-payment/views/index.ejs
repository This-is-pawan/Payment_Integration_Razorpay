<!DOCTYPE html>
<html>
<head>
  <title>Razorpay Payment</title>
</head>
<body>
  <h2>Pay with Razorpay</h2>

  <input type="number" id="amount" placeholder="Enter amount" />
  <button id="payBtn">Pay</button>

  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

  <script>

    document.getElementById("payBtn").onclick = async () => {
      const amount = document.getElementById("amount").value;

      const order = await fetch("/create-order", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ amount }),
      }).then(res => res.json());

      const options = {
        key: "<%= key %>",
        amount: order.amount,
        currency: "INR",
        name: "Demo Store",
        description: "Test Transaction",
        order_id: order.id,
        handler: async function (response) {
          const verify = await fetch("/verify-payment", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(response),
          }).then(res => res.json());

          if (verify.success) {
            window.location.href =
              `/payment-success?paymentId=${response.razorpay_payment_id}`;
          } else {
            alert("Payment verification failed");
          }
        },
        theme: { color: "#3399cc" },
      };

      const rzp = new Razorpay(options);
      rzp.open();
    };
  </script>
</body>
</html>
